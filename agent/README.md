# enki-agent

## Overview

An agent that allows a bank to communicate securely with enki.

## Build and run

Assuming you have an instance of [enki-core](../core) running, you'll need to do

```sh
export ENKI_SERVER_URL=http://localhost:3000/
export BANK_NAME=<some value>
export CONSUS_USER=<some value>
export AGENT_URL=<some value>
export OAUTH_CLIENT_ID=<some value>
# (This is also the default in project.clj, so it's optional if you're using the default enki-core config)

# Generate a new signing key and register with enki-core
lein run new-signing-key sign.key

# Run the agent process
lein run agent sign.key
```

The agent will now respond on [http://localhost:3010/](http://localhost:3010/)

Once that's running, you can send an assertion to be signed with:

```sh
curl -vsi -H Content-Type:application/json --data \
  @./test/clj/enki_agent/bletchley/data/metadata-assertion \
  http://localhost:3010/data
```

## Run in a REPL

Start up the webserver as follows (this assumes you've done `new-signing-key` with `sign.key` as the filename,
as above)

    lein repl
    ... Clojure booting stuff...
    user=> (repl/go)

This will now respond on [http://localhost:3010/](http://localhost:3010/)

Useful repl commands:

* `(repl/reset)` will reload the code and restart the server
* `(reload-logback)` will reload the logging config
* `(add-dep [foo.bar '1.2.3'])` can be used to add dependencies temporarily without having to restart the repl. They should be added to `project.clj` once you're definitely using them though!
* `(pst)` print most recent stacktrace

## API

An autogenerated list of the available API methods is available at [https://enki.stage.enki.services/api-docs/index.html#/api](https://enki.stage.enki.services/api-docs/index.html#/api).
This is generated from [../core/src/clj/enki_core/api.clj](../core/src/clj/enki_core/api.clj) using 
[compojure-api](https://github.com/metosin/compojure-api).

For more detail, see [docs/api.md](./docs/api.md)


